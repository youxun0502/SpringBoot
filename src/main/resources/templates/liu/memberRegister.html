<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">

  <link rel="stylesheet" th:href="@{/css/memberRegister.css}">
  <style>
    .mt-180 {
      margin-top: 180px;
    }


    .w-60 {
      width: 60%;
    }

    .formInputbg {
      background-color: rgba(57, 56, 56, 0.8) !important;
    }

    .bg-gray {
      background-color: rgba(28, 28, 28) !important;
    }

    .space {
      visibility: hidden;
    }


    @media (max-width: 600px) {
      body {
        background-image: none;
        background-color: rgb(39, 39, 39) !important;
      }
    }

    @media (min-width: 601px) {
      body {

        background-color: black !important;
      }

    }
  </style>

  <title>Member Register</title>
</head>


<body>
  <div th:replace="${session.memberBeans} ? ~{layout/navHomeLogin} : ~{layout/navHome} "></div>


  <div class="container vh-100">
    <div class="row h-100">
      <div class="col-12 col-lg-6 ms-lg-5 mx-auto">
        <div class="text-light mt-180 fs-3 p-3">建立您的帳戶</div>
        <div class="d-flex h-50  col-12 justify-content-center p-3">
          <form class="w-100 needs-validation" novalidate>
            <div class="mb-3">
              <label for="email" class="form-label form-control-lg col-12 text-light">Email</label>
              <input type="email" class="form-control formInputbg text-light" id="email" placeholder="請輸入您的電子郵件"
                pattern="^[^@\s]+@[^@\s]+\.[^@\s]+$" required />
              <div class="col-12 text-light space">space</div>
            </div>
            <div class="mb-3">
              <label for="password" class="form-label form-control-lg col-12 text-light">Password</label>
              <input type="password" class="form-control formInputbg text-light" id="password" placeholder="請輸入六位數以上英數字"
                pattern="[a-zA-Z0-9]{6,}" required />
              <div class="col-12 text-light space">space</div>
            </div>
            <button class="btn btn-primary col-12 col-lg-6" disabled>下一步</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>

    (function () {
      'use strict'
      var forms = document.querySelectorAll('.needs-validation');
      const spaceList = document.querySelectorAll('.space');

      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {


            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }

            spaceList.forEach(function (space) {
              space.style.display = 'none';
            })

            form.classList.add('was-validated')


          }, false)
        })
    })()


    const regex = /^[^@\s]+@[^@\s]+\.[^@\s]+$/;
    let emailContainer = document.querySelector('#email');
    let emailSpace = document.querySelector('.space');
    let pwdContainer = document.querySelector('#password');
    let pwdSpace = Array.from(document.querySelectorAll('.space'))[1];
    let nextStepBtn = document.querySelector('.btn');
    let emailStatus = false;

    emailContainer.addEventListener('input', function () {
      let email = emailContainer.value;
      checkEmail(email);
    })

    pwdContainer.addEventListener('input', function () {
      let pwd = pwdContainer.value;
      checkPwd(pwd);
    })

    function checkEmail(email) {

      let regex = /^[^@\s]+@[^@\s]+\.[^@\s]+$/;
      if (regex.test(email)) {
        pwdContainer.classList.add('is-valid');
        pwdContainer.classList.remove('is-invalid');
        pwdSpace.innerText = '請點選下一步';
        pwdSpace.classList.add('text-success');
        pwdSpace.classList.remove('space', 'text-light', 'text-danger');

        //axios

        //丟出email status
      } else {
        classMaker(emailContainer, emailSpace, '請輸入正確的電子郵件格式xxxx@xxxxx.xxx', false);
      }
    }

    function checkPwd(pwd, emailStatus) {
      let regex = /[a-zA-Z0-9]{6,}/;
      if (regex.test(pwd)) {
        if (emailStatus == true) {
          classMaker(pwdContainer, pwdSpace, '請點選下一步', true);
          nextStepBtn.removeAttribute('disabled');
        } else {
          classMaker(pwdContainer, pwdSpace, '密碼符合要求，請完成Email欄位', true);
          nextStepBtn.setAttribute('disabled', 'true');
        }

      } else {
        classMaker(pwdContainer, pwdSpace, '請輸入6位數以上英數字', false);
        nextStepBtn.setAttribute('disabled', 'true');
      }

    }

    function classMaker(container, space, text, status) {
      if (status == true) {
        container.classList.add('is-valid');
        container.classList.remove('is-invalid');
        space.classList.add('text-success');
        space.classList.remove('space', 'text-light', 'text-danger');
        space.innerText = text;
      } else {
        container.classList.add('is-invalid');
        container.classList.remove('is-valid');
        space.classList.add('text-danger');
        space.classList.remove('space', 'text-light', 'text-success');
        space.innerText = text;
      }
    }


  </script>
</body>

</html>